import Exploitation from '#models/exploitation'
import { PaginatedExploitationJson } from '../../types/models.js'
import { ModelPaginatorContract } from '@adonisjs/lucid/types/model'

export class ExploitationDto {
  constructor(private exploitations: ModelPaginatorContract<Exploitation>) {}

  toJson(): PaginatedExploitationJson {
    const transformedData = this.exploitations.toJSON().data.map((exploitation) => ({
      id: exploitation.id,
      name: exploitation.name,
      formeJuridique: exploitation.formeJuridique,
      siret: exploitation.siret,
      siren: exploitation.siren,
      denominationLegale: exploitation.denominationLegale,
      activite: exploitation.activite,
      addressLine1: exploitation.addressLine1,
      addressLine2: exploitation.addressLine2,
      commune: exploitation.commune,
      postalCode: exploitation.postalCode,
      postalBox: exploitation.postalBox,
      notes: exploitation.notes,
      location: exploitation.location,
      contacts: exploitation.contacts,
    }))

    return {
      meta: this.exploitations.getMeta(),
      data: transformedData,
    }
  }
}
