import Exploitation from '#models/exploitation'
import { ExploitationJson, PaginatedExploitationJson } from '../../types/models.js'
import { ModelPaginatorContract } from '@adonisjs/lucid/types/model'

export class ExploitationDto {
  constructor(private exploitations: ModelPaginatorContract<Exploitation>) {}

  static fromModel(exploitation: Exploitation): ExploitationJson {
    return {
      id: exploitation.id,
      name: exploitation.name,
      formeJuridique: exploitation.formeJuridique,
      siret: exploitation.siret,
      denominationLegale: exploitation.denominationLegale,
      activite: exploitation.activite,
      addressLine1: exploitation.addressLine1,
      addressLine2: exploitation.addressLine2,
      commune: exploitation.commune,
      postalCode: exploitation.postalCode,
      postalBox: exploitation.postalBox,
      notes: exploitation.notes,
      location: exploitation.location,
      contacts: exploitation.contacts,
    }
  }

  toJson(): PaginatedExploitationJson {
    const transformedData = (this.exploitations.toJSON().data as Exploitation[]).map(
      ExploitationDto.fromModel
    )

    return {
      meta: this.exploitations.getMeta(),
      data: transformedData,
    }
  }
}
