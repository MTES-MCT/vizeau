import ExploitationTag from '#models/exploitation_tag'

export class ExploitationTagService {
  /*
   * Create a new tag for a given exploitation. Only tags from the current exploitation will be selectable for log entries.
   * User ids are stored to track who created which tag but is not used for permission checks.
   */
  async createTagForExploitation(exploitationId: string, userId: string, tagName: string) {
    return await ExploitationTag.create({
      name: tagName,
      exploitationId,
      userId,
    })
  }

  async getTagsForExploitation(exploitationId: string) {
    return ExploitationTag.query()
      .where('exploitationId', exploitationId)
      .orderBy('updatedAt', 'desc')
  }

  async updateTag(tagId: number, tagName: string) {
    const tag = await ExploitationTag.findOrFail(tagId)
    tag.name = tagName
    await tag.save()
    return tag
  }

  async deleteTag(tagId: number) {
    const tag = await ExploitationTag.findOrFail(tagId)
    await tag.delete()
    return tag
  }
}
