import { BaseSchema } from '@adonisjs/lucid/schema'
import Exploitation from '#models/exploitation'
import Territoire from '#models/territoire'

export default class extends BaseSchema {
  protected tableName = Exploitation.table

  async up() {
    this.schema.alterTable(this.tableName, (table) => {
      table
        .uuid('territoire_id')
        .nullable()
        .references('id')
        .inTable(Territoire.table)
        .onDelete('SET NULL')

      table.string('denomination_legale').nullable()
      table.string('siren').nullable()
      table.string('activite').nullable()
      table.dropChecks('exploitations_type_structure_check')
      table.renameColumn('type_structure', 'forme_juridique')
      table.setNullable('forme_juridique')
    })
  }

  async down() {
    this.schema.alterTable(this.tableName, (table) => {
      table.dropColumn('territoire_id')
      table.dropColumn('denomination_legale')
      table.dropColumn('siren')
      table.dropColumn('activite')
      table.renameColumn('forme_juridique', 'type_structure')
    })
  }
}
