import { ExploitationJson } from '../../../types/models'
import SectionCard from '~/ui/SectionCard'
import { fr } from '@codegouvfr/react-dsfr'
import EmptyPlaceholder from '~/ui/EmptyPlaceholder'
import { router } from '@inertiajs/react'
import Ecosystem from '@codegouvfr/react-dsfr/picto/Ecosystem'

const iconColor = fr.colors.decisions.artwork.major.blueFrance.default
const textColor = fr.colors.decisions.text.mention.grey.default

function ContactInfo({ iconId, info }: { iconId: string; info: string }) {
  return (
    <div>
      <span className={`${iconId} fr-icon--sm fr-mr-2v`} style={{ color: iconColor }} />
      <span style={{ color: textColor }}>{info}</span>
    </div>
  )
}

function shouldDisplayContactInfo(contacts: ExploitationJson['contacts']): boolean {
  if (!contacts || contacts.length === 0) {
    return false
  }
  return Boolean(
    contacts[0].firstName ||
      contacts[0].lastName ||
      contacts[0].role ||
      contacts[0].email ||
      contacts[0].phoneNumber
  )
}

export function ExploitationContactCard({
  exploitation,
  editExploitationUrl,
}: {
  exploitation: ExploitationJson
  editExploitationUrl: string
}) {
  // If there are no contacts or no contact info to display, show placeholder
  if (
    !exploitation.contacts ||
    exploitation.contacts.length === 0 ||
    !shouldDisplayContactInfo(exploitation.contacts)
  ) {
    return (
      <SectionCard icon={'fr-icon-user-line'} title="Contact" size={'small'}>
        <EmptyPlaceholder
          pictogram={Ecosystem}
          label="Aucun contact renseignÃ©."
          handleClick={() => {
            router.get(editExploitationUrl)
          }}
          buttonLabel="Ajouter un contact"
          buttonIcon="fr-icon-add-line"
        />
      </SectionCard>
    )
  }

  const contact = exploitation.contacts[0]

  return (
    <SectionCard icon={'fr-icon-user-line'} title="Contact" size={'small'}>
      <div className="flex flex-col gap-3">
        {contact.firstName && contact.lastName && (
          <ContactInfo
            iconId="fr-icon-user-star-line"
            info={`${contact.firstName} ${contact.lastName.toUpperCase()}`}
          />
        )}
        {contact.role && <ContactInfo iconId="fr-icon-user-line" info={contact.role} />}
        {contact.email && <ContactInfo iconId="fr-icon-mail-line" info={contact.email} />}
        {contact.phoneNumber && (
          <ContactInfo iconId="fr-icon-phone-line" info={contact.phoneNumber} />
        )}
      </div>
    </SectionCard>
  )
}
