import { ExploitationJson } from '../../../types/models'
import EmptyPlaceholder from '~/ui/EmptyPlaceholder'
import { router } from '@inertiajs/react'
import Ecosystem from '@codegouvfr/react-dsfr/picto/Ecosystem'
import SmallSection from '~/ui/SmallSection'
import LabelInfo from '~/ui/LabelInfo'
import { displayContactName } from '~/functions/contacts'

const EMPTY_INFO_PLACEHOLDER = 'Non renseigné'

function shouldDisplayContactInfo(contacts: ExploitationJson['contacts']): boolean {
  if (!contacts || contacts.length === 0) {
    return false
  }
  return Boolean(
    contacts[0].firstName ||
      contacts[0].lastName ||
      contacts[0].role ||
      contacts[0].email ||
      contacts[0].phoneNumber
  )
}

export function ExploitationContactCard({
  exploitation,
  editExploitationUrl,
}: {
  exploitation: ExploitationJson
  editExploitationUrl: string
}) {
  // If there are no contacts or no contact info to display, show placeholder
  if (
    !exploitation.contacts ||
    exploitation.contacts.length === 0 ||
    !shouldDisplayContactInfo(exploitation.contacts)
  ) {
    return (
      <SmallSection iconId={'fr-icon-user-line'} title="Contact" priority="secondary" hasBorder>
        <EmptyPlaceholder
          pictogram={Ecosystem}
          label="Aucun contact renseigné."
          handleClick={() => router.visit(editExploitationUrl + '?step=3')}
          buttonLabel="Ajouter un contact"
          buttonIcon="fr-icon-add-line"
        />
      </SmallSection>
    )
  }

  const contact = exploitation.contacts[0]

  return (
    <SmallSection iconId={'fr-icon-user-line'} title="Contact" priority="secondary" hasBorder>
      <div className="flex flex-col gap-3">
        <LabelInfo size="sm" info={displayContactName(contact)} icon="fr-icon-user-star-line" />
        <LabelInfo
          size="sm"
          icon="fr-icon-user-line"
          info={contact.role || EMPTY_INFO_PLACEHOLDER}
        />
        <LabelInfo
          size="sm"
          icon="fr-icon-mail-line"
          info={contact.email || EMPTY_INFO_PLACEHOLDER}
        />
        <LabelInfo
          size="sm"
          icon="fr-icon-phone-line"
          info={contact.phoneNumber || EMPTY_INFO_PLACEHOLDER}
        />
      </div>
    </SmallSection>
  )
}
