import { ExploitationJson } from '../../../types/models'
import LabelInfo from '~/ui/LabelInfo'
import { ExploitationMap } from '~/components/exploitation-id/ExploitationMap'
import EmptyPlaceholder from '~/ui/EmptyPlaceholder'
import { MapPin } from '@codegouvfr/react-dsfr/picto'
import { router } from '@inertiajs/react'
import SmallSection from '~/ui/SmallSection'

function displayAddress(exploitation: ExploitationJson): string {
  let address = ''
  if (exploitation.addressLine1) {
    address += `${exploitation.addressLine1} - `
  }
  if (exploitation.postalCode) {
    address += `${exploitation.postalCode} `
  }
  if (exploitation.commune) {
    address += exploitation.commune
  }
  return address
}

export function ExploitationAddressCard({
  exploitation,
  editExploitationUrl,
}: {
  exploitation: ExploitationJson
  editExploitationUrl: string
}) {
  return (
    <SmallSection
      iconId={'fr-icon-map-pin-user-line'}
      title="Adresse de l'exploitation"
      priority="secondary"
      hasBorder
    >
      {exploitation.commune && <LabelInfo label="Commune" size="sm" info={exploitation.commune} />}
      {(exploitation.addressLine1 || exploitation.postalCode || exploitation.commune) && (
        <LabelInfo label="Adresse" size="sm" info={displayAddress(exploitation)} />
      )}
      {exploitation.location ? (
        <div className="fr-mt-1w">
          <ExploitationMap point={exploitation.location} />
        </div>
      ) : (
        <EmptyPlaceholder
          pictogram={MapPin}
          label="Aucune géolocalisation renseignée."
          handleClick={() => router.visit(editExploitationUrl + '?step=2')}
          buttonLabel="Localiser l'exploitation"
          buttonIcon="fr-icon-map-pin-2-line"
        />
      )}
    </SmallSection>
  )
}
