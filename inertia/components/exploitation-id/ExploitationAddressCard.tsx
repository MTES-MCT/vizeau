import { ExploitationJson } from '../../../types/models'
import SectionCard from '~/ui/SectionCard'
import LabelInfo from '~/ui/LabelInfo'
import { ExploitationMap } from '~/components/exploitation-id/ExploitationMap'
import EmptyPlaceholder from '~/ui/EmptyPlaceholder'
import { MapPin } from '@codegouvfr/react-dsfr/picto'
import { router } from '@inertiajs/react'

function displayAddress(exploitation: ExploitationJson): string {
  let address = ''
  if (exploitation.addressLine1) {
    address += `${exploitation.addressLine1} - `
  }
  if (exploitation.postalCode) {
    address += `${exploitation.postalCode} `
  }
  if (exploitation.commune) {
    address += exploitation.commune
  }
  return address
}

export function ExploitationAddressCard({
  exploitation,
  editExploitationUrl,
}: {
  exploitation: ExploitationJson
  editExploitationUrl: string
}) {
  return (
    <SectionCard
      icon={'fr-icon-map-pin-user-line'}
      title="Adresse de l'exploitation"
      size={'small'}
    >
      {exploitation.commune && <LabelInfo label="Commune" info={exploitation.commune} />}
      {(exploitation.addressLine1 || exploitation.postalCode || exploitation.commune) && (
        <LabelInfo label="Adresse" info={displayAddress(exploitation)} />
      )}
      {exploitation.location ? (
        <ExploitationMap point={exploitation.location} />
      ) : (
        <EmptyPlaceholder
          pictogram={MapPin}
          label="Aucune géolocalisation renseignée."
          handleClick={() => router.visit(editExploitationUrl + '?step=2')}
          buttonLabel="Localiser"
          buttonIcon="fr-icon-map-pin-2-line"
        />
      )}
    </SectionCard>
  )
}
