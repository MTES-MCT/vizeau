import { ExploitationLog } from '~/components/exploitation-id/ExploitationLog'
import { usePage, router } from '@inertiajs/react'
import { InferPageProps } from '@adonisjs/inertia/types'
import ExploitationsController from '#controllers/exploitations_controller'
import { FlashMessages } from '~/components/flash-message'
import { Tabs } from '@codegouvfr/react-dsfr/Tabs'
import ExploitationParcellesCard from './ExploitationParcelles'
import { ParcelleJson } from '../../../types/models'
import { useState } from 'react'
import Button from '@codegouvfr/react-dsfr/Button'

export type ExploitationMainColumnProps = {
  exploitationId: string
  parcelles: ParcelleJson[]
}

export function ExploitationMainColumn({ exploitationId, parcelles }: ExploitationMainColumnProps) {
  const [selectedTabId, setSelectedTabId] = useState('journal')
  const { flashMessages } = usePage<InferPageProps<ExploitationsController, 'get'>>().props

  return (
    <div className="flex flex-col gap-3">
      <Tabs
        selectedTabId={selectedTabId}
        tabs={[
          { tabId: 'journal', label: 'Journal de bord', iconId: 'fr-icon-draft-line' },
          { tabId: 'parcelles', label: 'Parcelles', iconId: 'fr-icon-stack-line' },
        ]}
        onTabChange={setSelectedTabId}
      >
        <div className={selectedTabId !== 'journal' ? 'hidden' : 'w-full flex flex-col gap-8'}>
          <Button
            priority="secondary"
            iconId="fr-icon-add-line"
            onClick={() => router.visit(`/exploitations/${exploitationId}/journal`)}
            style={{ width: '100%', justifyContent: 'center' }}
          >
            Ajouter une nouvelle entr√©e
          </Button>

          <div className="flex flex-col gap-4">
            <FlashMessages flashMessages={flashMessages} />
            <ExploitationLog exploitationId={exploitationId} />
          </div>
        </div>

        <div className={selectedTabId !== 'parcelles' ? 'hidden' : ''}>
          <ExploitationParcellesCard exploitationId={exploitationId} parcelles={parcelles} />
        </div>
      </Tabs>
    </div>
  )
}
