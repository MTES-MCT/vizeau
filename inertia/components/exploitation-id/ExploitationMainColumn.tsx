import SectionCard from '~/ui/SectionCard'
import { ExploitationLog } from '~/components/exploitation-id/ExploitationLog'
import { createModal } from '@codegouvfr/react-dsfr/Modal'
import { usePage, router } from '@inertiajs/react'
import { InferPageProps } from '@adonisjs/inertia/types'
import ExploitationsController from '#controllers/exploitations_controller'
import { FlashMessages } from '~/components/flash-message'

const createEntryLogModal = createModal({
  id: 'create-entry-log-modal',
  isOpenedByDefault: false,
})

export type ExploitationMainColumnProps = {
  exploitationId: string
}

export function ExploitationMainColumn({ exploitationId }: ExploitationMainColumnProps) {
  const { flashMessages } = usePage<InferPageProps<ExploitationsController, 'get'>>().props

  return (
    <>
      <SectionCard
        title="Journal de bord"
        actionIcon="fr-icon-add-line"
        actionLabel="Ajouter une nouvelle entrÃ©e"
        handleAction={() => router.visit(`/exploitations/${exploitationId}/journal`)}
      >
        <div className="flex flex-col gap-4">
          <FlashMessages flashMessages={flashMessages} />
          <ExploitationLog
            exploitationId={exploitationId}
            handlePlaceholderAction={createEntryLogModal.open}
          />
        </div>
      </SectionCard>
    </>
  )
}
