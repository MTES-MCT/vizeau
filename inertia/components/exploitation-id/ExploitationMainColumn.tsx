import SectionCard from '~/ui/SectionCard'
import { ExploitationLog } from '~/components/exploitation-id/ExploitationLog'
import { Input } from '@codegouvfr/react-dsfr/Input'
import SmallSection from '~/ui/SmallSection'
import { createModal } from '@codegouvfr/react-dsfr/Modal'
import { Form, usePage } from '@inertiajs/react'
import { InferPageProps } from '@adonisjs/inertia/types'
import ExploitationsController from '#controllers/exploitations_controller'
import { FlashMessages } from '~/components/flash-message'

const createEntryLogModal = createModal({
  id: 'create-entry-log-modal',
  isOpenedByDefault: false,
})

export function ExploitationMainColumn() {
  const { createEntryLogUrl, flashMessages } =
    usePage<InferPageProps<ExploitationsController, 'get'>>().props
  return (
    <>
      <SectionCard
        title="Journal de bord"
        actionIcon="fr-icon-add-line"
        actionLabel="Ajouter une nouvelle entrée"
        handleAction={createEntryLogModal.open}
      >
        <FlashMessages flashMessages={flashMessages} />
        <ExploitationLog />
      </SectionCard>
      <Form method="post" action={createEntryLogUrl} resetOnSuccess={true}>
        <createEntryLogModal.Component
          size="large"
          title={
            <>
              <span className="fr-icon-pen-nib-line fr-mr-1w" />
              Nouvelle entrée
            </>
          }
          buttons={[
            { children: 'Retour', doClosesModal: true },
            {
              children: 'Valider',
              type: 'submit',
            },
          ]}
        >
          <Input
            textArea
            label="Note"
            nativeTextAreaProps={{
              name: 'notes',
              maxLength: 1000,
            }}
          />
          <SmallSection title="Tags">Sélecteur de tags à implémenter</SmallSection>
        </createEntryLogModal.Component>
      </Form>
    </>
  )
}
