import SectionCard from '~/ui/SectionCard'
import { ExploitationLog } from '~/components/exploitation-id/ExploitationLog'
import { usePage, router } from '@inertiajs/react'
import { InferPageProps } from '@adonisjs/inertia/types'
import ExploitationsController from '#controllers/exploitations_controller'
import { FlashMessages } from '~/components/flash-message'
import ExploitationParcellesCard from './ExploitationParcellesCard'
import { ParcelleJson } from '../../../types/models'

export type ExploitationMainColumnProps = {
  exploitationId: string
  parcelles: ParcelleJson[]
}

export function ExploitationMainColumn({ exploitationId, parcelles }: ExploitationMainColumnProps) {
  const { flashMessages } = usePage<InferPageProps<ExploitationsController, 'get'>>().props

  return (
    <div className="flex flex-col gap-3">
      <SectionCard
        title="Journal de bord"
        actionIcon="fr-icon-add-line"
        actionLabel="Ajouter une nouvelle entrÃ©e"
        handleAction={() => router.visit(`/exploitations/${exploitationId}/journal`)}
      >
        <div className="flex flex-col gap-4">
          <FlashMessages flashMessages={flashMessages} />
          <ExploitationLog exploitationId={exploitationId} />
        </div>
      </SectionCard>

      <ExploitationParcellesCard exploitationId={exploitationId} parcelles={parcelles} />
    </div>
  )
}
