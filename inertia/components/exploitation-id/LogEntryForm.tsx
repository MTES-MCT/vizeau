import { Input } from '@codegouvfr/react-dsfr/Input'
import SectionCard from '~/ui/SectionCard'
import { TagSelector } from '~/components/exploitation-id/TagSelector'
import { LogEntryFormData } from '~/pages/journal/creation'
import { SetDataAction } from '@inertiajs/react'
import { formatDateFr } from '~/functions/date'

type EntryLogFormProps = {
  data: LogEntryFormData
  setData: SetDataAction<LogEntryFormData>
  inputValue: string
  setInputValue: (val: string) => void
  disabled?: boolean
}

export function LogEntryForm({
  data,
  setData,
  inputValue,
  setInputValue,
  disabled = false,
}: EntryLogFormProps) {
  return (
    <>
      {!disabled ? (
        <Input
          label="Titre"
          nativeInputProps={{
            name: 'title',
            maxLength: 255,
            value: data.title,
            onChange: (e) => setData('title', e.target.value),
          }}
        />
      ) : (
        <SectionCard size="small" background="secondary" icon="fr-icon-draft-line" title="Titre">
          <p>{data.title || <i>Cette tâche n'a pas de titre.</i>}</p>
        </SectionCard>
      )}
      {!disabled ? (
        <Input
          label="Date de la tâche"
          nativeInputProps={{
            name: 'date',
            type: 'date',
            value: data.date,
            onChange: (e) => setData('date', e.target.value),
          }}
        />
      ) : (
        <SectionCard size="small" background="secondary" icon="fr-icon-calendar-line" title="Date">
          <p>{formatDateFr(data.date) || <i>Cette tâche n'a pas de date.</i>}</p>
        </SectionCard>
      )}
      {!disabled ? (
        <Input
          textArea
          label="Note"
          nativeTextAreaProps={{
            name: 'notes',
            maxLength: 1000,
            value: data.notes,
            rows: 5,
            onChange: (e) => setData('notes', e.target.value),
          }}
        />
      ) : (
        <SectionCard size="small" background="secondary" icon="fr-icon-draft-line" title="Notes">
          <p>{data.notes || <i>Aucune note enregistrée.</i>}</p>
        </SectionCard>
      )}
      <SectionCard size="small" background="secondary" icon="fr-icon-star-line" title="Étiquettes">
        <TagSelector
          inputValue={inputValue}
          setInputValue={setInputValue}
          logEntryId={data.id}
          values={data.tags}
          onChange={(tags) => setData('tags', tags)}
          disabled={disabled}
        />
      </SectionCard>
    </>
  )
}
