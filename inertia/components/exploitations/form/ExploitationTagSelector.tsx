import InputWithSelector, { OptionType } from '~/ui/InputWithSelector'
import { Tag } from '@codegouvfr/react-dsfr/Tag'

type ExploitationTagSelectorProps = {
  inputValue: string
  setInputValue: (value: string) => void
  options: OptionType<number>[]
  values: number[]
  onChange: (values: number[]) => void
  disabled?: boolean
}

export function ExploitationTagSelector({
  inputValue,
  setInputValue,
  options,
  values,
  onChange,
  disabled = false,
}: ExploitationTagSelectorProps) {
  const selectedTags: ExploitationTagSelectorProps['options'] = options.filter((o) => o.isSelected)
  const filteredOptions = options.filter((o) =>
    o.label.toLowerCase().includes(inputValue.trim().toLowerCase())
  )

  return (
    <div className="flex flex-col gap-2">
      {!disabled && (
        <div className="flex gap-3 *:first:flex-1">
          <InputWithSelector
            inputValue={inputValue}
            options={filteredOptions}
            handleInputChange={setInputValue}
            onOptionChange={(updatedOption) => {
              if (updatedOption.isSelected) {
                onChange([...values, updatedOption.value])
              } else {
                onChange(values.filter((v) => v !== updatedOption.value))
              }
            }}
            label="Ajouter des types d'agricultures"
            hintText="Sélectionner les types d'agricultures correspondant à l'exploitation"
          />
        </div>
      )}
      <div className="flex flex-wrap gap-2">
        {selectedTags.map((tag) => (
          <Tag
            key={tag.value}
            nativeButtonProps={{
              disabled,
              onClick: () => {
                onChange(values.filter((v) => v !== tag.value))
              },
            }}
            dismissible={true}
          >
            {tag.label}
          </Tag>
        ))}
      </div>
    </div>
  )
}
