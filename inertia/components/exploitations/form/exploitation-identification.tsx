import { useState } from 'react'
import { fr } from '@codegouvfr/react-dsfr'
import Input from '@codegouvfr/react-dsfr/Input'

import MajorSelector from '~/ui/MajorSelector'
import SectionCard from '~/ui/SectionCard'
import SearchRaisonSociale from '~/components/search-raison-sociale'

import type { RaisonSociale } from '~/components/search-raison-sociale'

export default function ExploitationIdentification({
  exploitationIdentification,
  setExploitationIdentification,
  error,
}: {
  exploitationIdentification: RaisonSociale | null
  setExploitationIdentification: (value: RaisonSociale | null) => void
  error?: {[key: string]: any}
}) {
  const [raisonSociale, setRaisonSociale] = useState(
    exploitationIdentification && Object.keys(exploitationIdentification).length > 0
      ? exploitationIdentification.siren
        ? 'Avec raison sociale'
        : 'Sans raison sociale'
      : null
  )

  return (
    <>
      <div className="fr-grid-row fr-grid-row--gutters fr-mt-6w">
        <div className="fr-col-6">
          <MajorSelector
            value="Avec raison sociale"
            label="Avec raison sociale"
            icon="fr-icon-building-line"
            isSelected={raisonSociale === 'Avec raison sociale'}
            getValue={(value) => setRaisonSociale(value)}
          />
        </div>
        <div className="fr-col-6">
          <MajorSelector
            value="Sans raison sociale"
            label="Sans raison sociale"
            icon="fr-icon-user-line"
            isSelected={raisonSociale === 'Sans raison sociale'}
            getValue={(value) => setRaisonSociale(value)}
          />
        </div>
      </div>
      {raisonSociale && (
        <div className="fr-mt-4w">
          <SectionCard
            title={`Exploitation ${raisonSociale.toLowerCase()}`}
            icon={raisonSociale === 'Avec raison sociale' ? 'building-line' : 'user-line'}
            background="secondary"
          >
            {raisonSociale === 'Avec raison sociale' ? (
              <div>
                <SearchRaisonSociale
                  value={exploitationIdentification}
                  onChange={(value) => setExploitationIdentification(value)}
                  error={error}
                />
                <Input
                  className="fr-mt-3w"
                  label="Libellé de l’exploitation"
                  hintText="Permet de donner un nom personnalisé à l’exploitation pour l’affichage dans l’application. Si laissé vide, le nom de la raison sociale sera utilisé."
                  nativeInputProps={{
                    placeholder: 'Entrer le nom de l’exploitation',
                    defaultValue:
                      exploitationIdentification?.name || exploitationIdentification?.nom_complet,
                    onChange: (e) => {
                      setExploitationIdentification({
                        ...exploitationIdentification,
                        name: e.target.value,
                      } as RaisonSociale)
                    },
                  }}
                />
              </div>
            ) : (
              <div>
                <Input
                  className="fr-mt-3w"
                  label="Libellé de l’exploitation *"
                  hintText="Saisir un nom pour identifier l’exploitation"
                  nativeInputProps={{
                    placeholder: 'Entrer le nom de l’exploitation',
                    defaultValue: exploitationIdentification?.name,
                    onChange: (e) => {
                      setExploitationIdentification({
                        ...exploitationIdentification,
                        name: e.target.value,
                      } as RaisonSociale)
                    },
                  }}
                />
              </div>
            )}
          </SectionCard>
          {exploitationIdentification && exploitationIdentification.siren && (
            <div
              className="fr-mt-2w fr-p-2w"
              style={{
                border: `1px solid ${fr.colors.decisions.border.default.grey.default}`,
                borderRadius: '8px',
              }}
            >
              <div className="fr-mb-1w">
                <b>Dénomination : </b> {exploitationIdentification?.nom_complet}
              </div>
              <div className="fr-mb-1w">
                <b>SIREN : </b> {exploitationIdentification?.siren}
              </div>
              <div className="fr-mb-1w">
                <b>SIRET : </b> {exploitationIdentification?.siege?.siret}
              </div>
              <div className="fr-mb-1w">
                <b>Activité principale (NAF / APE) : </b>{' '}
                {exploitationIdentification?.activite_principale}
              </div>
              <div className="fr-mb-1w">
                <b>Forme juridique : </b> {exploitationIdentification?.categorie_entreprise}
              </div>
            </div>
          )}
        </div>
      )}
    </>
  )
}
