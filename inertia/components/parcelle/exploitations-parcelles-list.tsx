import { router } from '@inertiajs/react'
import cultures from '../../../database/data/cultures.json'
import ListItem from '~/ui/ListItem'
import { ParcelleJson } from '../../../types/models'

export type ExploitationParcellesListProps = {
  parcelles: ParcelleJson[]
  exploitationId: string
  reloadProp?: string
}

export default function ExploitationParcellesList({
  parcelles,
  exploitationId,
  reloadProp = 'exploitation',
}: ExploitationParcellesListProps) {
  const handleDetachParcelle = (rpgId: string, year: number) => {
    router.post(
      `/exploitations/${exploitationId}/parcelles/${rpgId}/detach`,
      { year },
      {
        preserveScroll: true,
        only: [reloadProp],
      }
    )
  }

  return (
    <>
      {parcelles.map((parcelle) => (
        <ListItem
          key={parcelle.rpgId}
          hasBorder
          variant="compact"
          title={`Parcelle RPG ${parcelle.rpgId}`}
          actions={[
            {
              label: 'DÃ©tacher la parcelle',
              onClick: () => handleDetachParcelle(parcelle.rpgId, parcelle.year),
              iconId: 'fr-icon-link-unlink',
              isCritical: true,
            },
          ]}
          tags={[
            {
              label:
                cultures.find((culture) => culture.code === parcelle.cultureCode)?.label ||
                'Culture inconnue',
            },
          ]}
          metas={[
            { content: `${parcelle.surface} ha`, iconId: 'fr-icon-ruler-line' },
            { content: parcelle.year.toString(), iconId: 'fr-icon-calendar-line' },
          ]}
        />
      ))}
    </>
  )
}
